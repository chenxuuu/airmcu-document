import{_ as t}from"./plugin-vue_export-helper-x3n3nnut.js";import{r as p,o as i,c,a as n,b as s,d as o,w as l,e as a}from"./app-L4q_l0Kg.js";const u="/assets/QQ20230824141517-HlXWXD5n.png",d="/assets/QQ20230824141534-fmGP6onh.png",r="/assets/EB3567B1-7F1A-4da0-A8C6-5F24503D9588-HD-HVfp2.png",k={},m=a('<h2 id="简介" tabindex="-1"><a class="header-anchor" href="#简介" aria-hidden="true">#</a> 简介</h2><p>本章介绍使用Air001开发板驱动 DS18B20。</p><div class="hint-container tip"><p class="hint-container-title">提示</p><p>DS18B20 是数字温度传感器，使用1Wire(单总线)通信接口，只需要一条数据线 (和地线) 即可与处理器进行数据传输。<br> 器件可以工作在-55°C至+125°C范围，在-10°C至+85°C范围内测量精度为±0.5°C。<br> 每个DS18B20具有唯一的64位序列号，从而允许多个DS18B20挂接在同一条1-Wire总线。</p></div><h2 id="硬件准备" tabindex="-1"><a class="header-anchor" href="#硬件准备" aria-hidden="true">#</a> 硬件准备</h2>',4),v=n("code",null,"Air001",-1),b=n("code",null,"DAPLink调试器",-1),g=n("li",null,[n("p",null,[s("将"),n("code",null,"DS18B20"),s("模块与"),n("code",null,"Air001开发板"),s("，按如下表格进行相连：")])],-1),h=a('<table><thead><tr><th style="text-align:center;">DS18B20</th><th style="text-align:center;">Air001</th></tr></thead><tbody><tr><td style="text-align:center;">GND</td><td style="text-align:center;">GND</td></tr><tr><td style="text-align:center;">VCC</td><td style="text-align:center;">3.3V</td></tr><tr><td style="text-align:center;">DQ</td><td style="text-align:center;">PA_5</td></tr></tbody></table><div class="hint-container warning"><p class="hint-container-title">注意</p><p>如果你是直接连接的<code>DS18B20</code>元器件，你需要为<code>DQ</code>进行上拉操作。<br> （比如在<code>VCC</code>与<code>DQ</code>之间连接一颗<code>4.7K电阻</code>）</p></div><h2 id="软件部分" tabindex="-1"><a class="header-anchor" href="#软件部分" aria-hidden="true">#</a> 软件部分</h2><p>首先，安装<code>DallasTemperature</code>库，并选择<code>全部安装</code>以安装所需依赖。</p><details class="hint-container details"><summary>打开Arduino管理库，进行安装</summary><p>可以打开Arduino管理库，找到<code>Adafruit DallasTemperature Library</code>库，并选择<code>全部安装</code>以安装所需依赖。</p><figure><img src="'+u+'" alt="库管理器中的 Adafruit DallasTemperature Library" tabindex="0" loading="lazy"><figcaption>库管理器中的 Adafruit DallasTemperature Library</figcaption></figure><figure><img src="'+d+'" alt="全部安装" tabindex="0" loading="lazy"><figcaption>全部安装</figcaption></figure></details><p>为了保证单总线的时序保持正常，我们需要将芯片主频设置为最高的 48M。</p><details class="hint-container details"><summary>在Arduino中设置芯片主频</summary><figure><img src="'+r+`" alt="设置芯片主频" tabindex="0" loading="lazy"><figcaption>设置芯片主频</figcaption></figure></details><p>开头引用<code>OneWire</code>包与<code>DallasTemperature</code>包，并实例化对象<code>sensors</code>，后续仅需调用<code>sensors</code>对象即可使用DS18B20。</p><div class="language-cpp line-numbers-mode" data-ext="cpp"><pre class="language-cpp"><code><span class="token comment">// 引用必要的库</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;OneWire.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;DallasTemperature.h&gt;</span></span>

<span class="token comment">// 初始化一个单总线对象，设置使用PA_5引脚进行通信</span>
OneWire <span class="token function">oneWire</span><span class="token punctuation">(</span>PA_5<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 初始化一个传感器对象，使用刚新建的单总线对象</span>
DallasTemperature <span class="token function">sensors</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>oneWire<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在<code>setup()</code>函数中初始化串口与<code>sensors</code>对象：</p><div class="language-cpp line-numbers-mode" data-ext="cpp"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//初始化串口</span>
  Serial<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token number">9600</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//初始化传感器库</span>
  sensors<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在<code>loop()</code>函数中添加如下代码：</p><div class="language-cpp line-numbers-mode" data-ext="cpp"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Serial<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;开始获取温度信息...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  sensors<span class="token punctuation">.</span><span class="token function">requestTemperatures</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//发出获取温度的请求</span>
  Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;获取完成&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 我们只取第一个传感器的温度信息</span>
  <span class="token keyword">float</span> tempC <span class="token operator">=</span> sensors<span class="token punctuation">.</span><span class="token function">getTempCByIndex</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//检查一下是不是真的获取成功了</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>tempC <span class="token operator">!=</span> DEVICE_DISCONNECTED_C<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Serial<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;获取到的温度为：&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Serial<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>tempC<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;℃&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;数据读取失败！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>使用<code>sensors.requestTemperatures</code>方法，尝试获取温度。</li><li>使用<code>sensors.getTempCByIndex</code>方法，获取到第一个设备的温度值。</li><li>如果成功获取，将温度值打印出来</li></ul><h2 id="输出结果" tabindex="-1"><a class="header-anchor" href="#输出结果" aria-hidden="true">#</a> 输出结果</h2><p>在串口监视器中将波特率调至9600，可观察到当前的信息，如下：</p><div class="language-log line-numbers-mode" data-ext="log"><pre class="language-log"><code>开始获取温度信息<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>获取完成
获取到的温度为：<span class="token number">27.19</span>℃

开始获取温度信息<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>获取完成
获取到的温度为：<span class="token number">27.25</span>℃

开始获取温度信息<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>获取完成
获取到的温度为：<span class="token number">27.19</span>℃

开始获取温度信息<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>获取完成
获取到的温度为：<span class="token number">27.25</span>℃

开始获取温度信息<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>获取完成
获取到的温度为：<span class="token number">27.19</span>℃

开始获取温度信息<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,17);function f(_,y){const e=p("RouterLink");return i(),c("div",null,[m,n("ul",null,[n("li",null,[n("p",null,[s("按"),o(e,{to:"/tutorial-advanced/Air001_start.html"},{default:l(()=>[s("☁️ Air001开发板入门")]),_:1}),s("，将"),v,s("和"),b,s("使用排针排母连接。")])]),g]),h])}const C=t(k,[["render",f],["__file","ds18b20.html.vue"]]);export{C as default};
