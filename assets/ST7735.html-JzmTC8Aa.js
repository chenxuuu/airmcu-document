import{_ as e}from"./plugin-vue_export-helper-x3n3nnut.js";import{r as p,o,c,a as n,b as s,d as i,w as l,e as a}from"./app-L4q_l0Kg.js";const u="/assets/QQ20230809170319-eC07EZBt.png",r="/assets/QQ20230809170310-s_-q0YIq.png",d="/assets/ST7735_on-aCQn-qQr.jpg",k="/assets/ST7735_b-vXqtxsBb.png",m={},v=a('<h2 id="简介" tabindex="-1"><a class="header-anchor" href="#简介" aria-hidden="true">#</a> 简介</h2><p>本章介绍使用Air001开发板驱动ST7735。</p><div class="hint-container tip"><p class="hint-container-title">提示</p><p>ST7735是一款具有SPI接口的彩色TFT液晶显示驱动芯片。</p></div><h2 id="硬件准备" tabindex="-1"><a class="header-anchor" href="#硬件准备" aria-hidden="true">#</a> 硬件准备</h2>',4),b=n("code",null,"Air001",-1),y=n("code",null,"DAPLink调试器",-1),_=n("li",null,[n("p",null,[s("将"),n("code",null,"ST7735"),s("模块与"),n("code",null,"Air001开发板"),s("，按如下表格进行相连：")])],-1),g=a('<table><thead><tr><th style="text-align:center;">ST7735</th><th style="text-align:center;">Air001</th></tr></thead><tbody><tr><td style="text-align:center;">GND</td><td style="text-align:center;">GND</td></tr><tr><td style="text-align:center;">VCC</td><td style="text-align:center;">3.3V</td></tr><tr><td style="text-align:center;">CLK</td><td style="text-align:center;">PA_5</td></tr><tr><td style="text-align:center;">MOSI(DAT)</td><td style="text-align:center;">PA_7</td></tr><tr><td style="text-align:center;">RES</td><td style="text-align:center;">PA_6</td></tr><tr><td style="text-align:center;">DC</td><td style="text-align:center;">PB_1</td></tr><tr><td style="text-align:center;">CS</td><td style="text-align:center;">PA_4</td></tr><tr><td style="text-align:center;">BL</td><td style="text-align:center;">PB_0</td></tr></tbody></table><h2 id="软件部分" tabindex="-1"><a class="header-anchor" href="#软件部分" aria-hidden="true">#</a> 软件部分</h2><p>在Arduino的库管理中搜索并安装<code>Adafruit ST7735 and ST7789 Library</code>，并选择<code>全部安装</code>以安装所需依赖。</p><details class="hint-container details"><summary>打开Arduino管理库，进行安装</summary><figure><img src="'+u+'" alt="搜索Adafruit ST7735 and ST7789 Library包" tabindex="0" loading="lazy"><figcaption>搜索Adafruit ST7735 and ST7789 Library包</figcaption></figure><figure><img src="'+r+`" alt="全部安装" tabindex="0" loading="lazy"><figcaption>全部安装</figcaption></figure></details><p>首先引用这些库，并定义需要用的参数：</p><div class="language-cpp line-numbers-mode" data-ext="cpp"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Adafruit_GFX.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Adafruit_ST7735.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;SPI.h&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">TFT_CS</span> <span class="token expression">PA_4</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">TFT_RST</span> <span class="token expression">PA_6</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">TFT_DC</span> <span class="token expression">PB_1</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">TFT_MOSI</span> <span class="token expression">PA_7</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">TFT_SCLK</span> <span class="token expression">PA_5</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">SerialDebugging</span> <span class="token expression"><span class="token boolean">true</span></span></span>

Adafruit_ST7735 tft <span class="token operator">=</span> <span class="token function">Adafruit_ST7735</span><span class="token punctuation">(</span>TFT_CS<span class="token punctuation">,</span> TFT_DC<span class="token punctuation">,</span> TFT_MOSI<span class="token punctuation">,</span> TFT_SCLK<span class="token punctuation">,</span> TFT_RST<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token keyword">uint8_t</span> Button_pin <span class="token operator">=</span> PB_6<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>开头我们用调用下载的<code>Adafruit_GFX.h</code>、<code>Adafruit_ST7735.h</code>包以及Arduino自带的<code>SPI.h</code>包。</li><li>依据Air001的接线，定义相关引脚。</li><li>实例化同时初始化<code>Adafruit_ST7735</code>的对象<code>tft</code>，后续仅需调用<code>tft</code>即可驱动<code>ST7735</code>。</li><li>将Air001开发板上的<code>BOOT</code>按钮对应的引脚<code>PB_6</code>定义为屏幕响应按键。</li></ul><div class="language-cpp line-numbers-mode" data-ext="cpp"><pre class="language-cpp"><code><span class="token keyword">const</span> <span class="token keyword">uint16_t</span> Display_Color_Black <span class="token operator">=</span> <span class="token number">0x0000</span><span class="token punctuation">;</span> <span class="token comment">//黑</span>
<span class="token keyword">const</span> <span class="token keyword">uint16_t</span> Display_Color_Blue <span class="token operator">=</span> <span class="token number">0x001F</span><span class="token punctuation">;</span>  <span class="token comment">//蓝</span>

<span class="token keyword">uint16_t</span> Display_Text_Color <span class="token operator">=</span> Display_Color_Black<span class="token punctuation">;</span>
<span class="token keyword">uint16_t</span> Display_Backround_Color <span class="token operator">=</span> Display_Color_Blue<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>我们用<code>cosnt</code>定义颜色并防止其被更改。</li><li>定义文本颜色和背景颜色。</li></ul><div class="hint-container tip"><p class="hint-container-title">提示</p><p>可以使用(包括但不限于)如下代码定义其他颜色：</p><div class="language-cpp line-numbers-mode" data-ext="cpp"><pre class="language-cpp"><code><span class="token keyword">const</span> <span class="token keyword">uint16_t</span> Display_Color_Red <span class="token operator">=</span> <span class="token number">0xF800</span><span class="token punctuation">;</span>      <span class="token comment">//红</span>
<span class="token keyword">const</span> <span class="token keyword">uint16_t</span> Display_Color_Cyan <span class="token operator">=</span> <span class="token number">0x07FF</span><span class="token punctuation">;</span>     <span class="token comment">//青</span>
<span class="token keyword">const</span> <span class="token keyword">uint16_t</span> Display_Color_Green <span class="token operator">=</span> <span class="token number">0x07E0</span><span class="token punctuation">;</span>    <span class="token comment">//绿</span>
<span class="token keyword">const</span> <span class="token keyword">uint16_t</span> Display_Color_White <span class="token operator">=</span> <span class="token number">0xFFFF</span><span class="token punctuation">;</span>    <span class="token comment">//白</span>
<span class="token keyword">const</span> <span class="token keyword">uint16_t</span> Display_Color_Yellow <span class="token operator">=</span> <span class="token number">0xFFE0</span><span class="token punctuation">;</span>   <span class="token comment">//黄</span>
<span class="token keyword">const</span> <span class="token keyword">uint16_t</span> Display_Color_Magenta <span class="token operator">=</span> <span class="token number">0xF81F</span><span class="token punctuation">;</span>  <span class="token comment">//粉</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里的颜色格式为<code>RGB565</code>，每个像素用16比特位表示，占2个字节，RGB分量分别使用5位、6位、5位。</p></div><div class="language-cpp line-numbers-mode" data-ext="cpp"><pre class="language-cpp"><code><span class="token keyword">const</span> size_t MaxString <span class="token operator">=</span> <span class="token number">32</span><span class="token punctuation">;</span>
<span class="token keyword">char</span> oldTimeString<span class="token punctuation">[</span>MaxString<span class="token punctuation">]</span>           <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>定义字符串缓冲区大小。</li><li>初始空的字符串，用于显示。</li></ul><p>我们在<code>setup()</code>函数中添加如下代码进行初始化操作。</p><div class="language-cpp line-numbers-mode" data-ext="cpp"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//SerialDebugging在开头被定义为TRUE，这片宏定义区域生效</span>
    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>SerialDebugging<span class="token punctuation">)</span></span></span>
    <span class="token comment">//初始化串口，用于输出日志</span>
    Serial<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token number">115200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>Serial<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
    <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">250</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//初始化屏幕</span>
    tft<span class="token punctuation">.</span><span class="token function">initR</span><span class="token punctuation">(</span>INITR_BLACKTAB<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//初始化字体</span>
    tft<span class="token punctuation">.</span><span class="token function">setFont</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//用蓝色填充屏幕</span>
    tft<span class="token punctuation">.</span><span class="token function">fillScreen</span><span class="token punctuation">(</span>Display_Backround_Color<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//设定文字颜色</span>
    tft<span class="token punctuation">.</span><span class="token function">setTextColor</span><span class="token punctuation">(</span>Display_Text_Color<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//设定文字大小</span>
    tft<span class="token punctuation">.</span><span class="token function">setTextSize</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>定义<code>displayUpTime</code>函数，内容如下：</p><div class="language-cpp line-numbers-mode" data-ext="cpp"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">displayUpTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> upSeconds <span class="token operator">=</span> <span class="token function">millis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> days <span class="token operator">=</span> upSeconds <span class="token operator">/</span> <span class="token number">86400</span><span class="token punctuation">;</span>
    upSeconds <span class="token operator">=</span> upSeconds <span class="token operator">%</span> <span class="token number">86400</span><span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> hours <span class="token operator">=</span> upSeconds <span class="token operator">/</span> <span class="token number">3600</span><span class="token punctuation">;</span>
    upSeconds <span class="token operator">=</span> upSeconds <span class="token operator">%</span> <span class="token number">3600</span><span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> minutes <span class="token operator">=</span> upSeconds <span class="token operator">/</span> <span class="token number">60</span><span class="token punctuation">;</span>
    upSeconds <span class="token operator">=</span> upSeconds <span class="token operator">%</span> <span class="token number">60</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span> newTimeString<span class="token punctuation">[</span>MaxString<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">sprintf</span><span class="token punctuation">(</span>
        newTimeString<span class="token punctuation">,</span>
        <span class="token string">&quot;%lu %02lu:%02lu:%02lu&quot;</span><span class="token punctuation">,</span>
        days<span class="token punctuation">,</span> hours<span class="token punctuation">,</span> minutes<span class="token punctuation">,</span> upSeconds
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strcmp</span><span class="token punctuation">(</span>newTimeString<span class="token punctuation">,</span>oldTimeString<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        tft<span class="token punctuation">.</span><span class="token function">setCursor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tft<span class="token punctuation">.</span><span class="token function">setTextColor</span><span class="token punctuation">(</span>Display_Backround_Color<span class="token punctuation">)</span><span class="token punctuation">;</span>
        tft<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>oldTimeString<span class="token punctuation">)</span><span class="token punctuation">;</span>
        tft<span class="token punctuation">.</span><span class="token function">setCursor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tft<span class="token punctuation">.</span><span class="token function">setTextColor</span><span class="token punctuation">(</span>Display_Text_Color<span class="token punctuation">)</span><span class="token punctuation">;</span>
        tft<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>newTimeString<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">strcpy</span><span class="token punctuation">(</span>oldTimeString<span class="token punctuation">,</span>newTimeString<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>计算显示的天数、小时、分钟、秒钟,将其显示并刷新(每次刷新消耗约2.5s)。</li></ul><p>最后在<code>loop()</code>函数中添加代码。</p><div class="language-cpp line-numbers-mode" data-ext="cpp"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//显示当前的时间</span>
    <span class="token function">displayUpTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>调用函数<code>displayUpTime</code>输出显示当前时间。</li><li>延时</li></ul><h2 id="输出结果" tabindex="-1"><a class="header-anchor" href="#输出结果" aria-hidden="true">#</a> 输出结果</h2><p>屏幕底色为蓝色，在最上方显示一行黑色的显示时长：</p><figure><img src="`+d+'" alt="注意，某些屏幕需要更改偏移值，不然会像这块屏幕一样有彩边" tabindex="0" loading="lazy"><figcaption>注意，某些屏幕需要更改偏移值，不然会像这块屏幕一样有彩边</figcaption></figure><p>同时在串口监视器中将波特率调为115200可观察到如下字样：</p><figure><img src="'+k+'" alt="日志" tabindex="0" loading="lazy"><figcaption>日志</figcaption></figure>',25);function f(h,T){const t=p("RouterLink");return o(),c("div",null,[v,n("ul",null,[n("li",null,[n("p",null,[s("按"),i(t,{to:"/tutorial-advanced/Air001_start.html"},{default:l(()=>[s("☁️ Air001开发板入门")]),_:1}),s("，将"),b,s("和"),y,s("使用排针排母连接。")])]),_]),g])}const w=e(m,[["render",f],["__file","ST7735.html.vue"]]);export{w as default};
